<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TR-VOID | SHARE PANEL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: #eee; font-family: sans-serif; overflow-x: hidden; }
        .glass { background: rgba(20, 20, 20, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.05); }
        .input-box { background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); padding: 20px; border-radius: 24px; color: #fff; width: 100%; margin-bottom: 20px; outline: none; transition: 0.3s; }
        .input-box:focus { border-color: #2563eb; box-shadow: 0 0 20px rgba(37,99,235,0.1); }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; scale: 0.95; } to { opacity: 1; scale: 1; } }
    </style>
</head>
<body class="p-8 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-blue-900/20 via-black to-black min-h-screen">
    <div id="content" class="hidden max-w-4xl mx-auto fade-in">
        <nav class="flex justify-between items-center mb-12">
            <button onclick="location.href='index.html'" class="hover:rotate-[-10deg] transition-transform">
                <img src="home-icon.png" class="w-10 h-10 shadow-lg">
            </button>
            <h1 class="text-3xl font-black italic tracking-tighter text-white">TR-VOID <span class="text-blue-500">SHARE</span></h1>
            <button onclick="location.href='index.html'" class="text-xs font-bold text-gray-500 hover:text-white transition-colors tracking-widest uppercase">BACK</button>
        </nav>

        <div class="glass p-10 rounded-[3.5rem] border-blue-500/10 mb-12 shadow-2xl">
            <div class="flex items-center gap-4 mb-8">
                <div class="p-3 bg-blue-600/20 rounded-2xl">
                    <img src="search-budget.png" class="w-6 h-6">
                </div>
                <h2 class="text-2xl font-bold">Publish New Code</h2>
            </div>
            <input type="text" id="title" class="input-box" placeholder="Title (e.g. Discord Bot Base)">
            <textarea id="code" class="input-box h-64 font-mono text-sm" placeholder="Paste your codes here..."></textarea>
            <button onclick="publish()" class="w-full bg-blue-600 hover:bg-blue-500 p-5 rounded-2xl font-black transition-all transform active:scale-95 shadow-lg shadow-blue-600/20 uppercase">Publish to System</button>
        </div>

        <h3 class="text-sm font-bold text-blue-500 mb-6 tracking-[0.3em] uppercase ml-4">Managed Content</h3>
        <div id="admin-list" class="grid gap-4"></div>
    </div>

    <script>
        const user = JSON.parse(sessionStorage.getItem('tr_void_user'));
        if(!user) location.href='index.html'; else document.getElementById('content').classList.remove('hidden');

        async function publish() {
            const title = document.getElementById('title').value;
            const content = document.getElementById('code').value;
            if(!title || !content) return alert("Please fill all fields!");

            await fetch('/api/api', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ title, content, author: user.username })
            });
            location.reload();
        }

        async function loadAdminCodes() {
            const res = await fetch('/api/api');
            const data = await res.json();
            document.getElementById('admin-list').innerHTML = data.map(c => `
                <div class="glass p-6 rounded-[2rem] flex justify-between items-center hover:border-blue-500/30 transition-all">
                    <div class="flex items-center gap-4">
                        <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                        <p class="text-white font-bold italic text-lg">${c.title}</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="editCode('${c._id}')" class="bg-white/5 hover:bg-blue-600/20 p-4 rounded-2xl transition-all">
                            <img src="edit-code-pencil-icon.png" class="w-4 h-4">
                        </button>
                        <button onclick="deleteCode('${c._id}')" class="bg-red-500/5 hover:bg-red-500 p-4 px-6 rounded-2xl text-red-500 hover:text-white text-xs font-black transition-all uppercase">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        async function editCode(id) {
            const newC = prompt("Enter new code content:");
            if(newC) {
                await fetch('/api/api', { method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ _id: id, content: newC }) });
                loadAdminCodes();
            }
        }

        async function deleteCode(id) {
            if(confirm("Are you sure you want to delete this code?")) {
                await fetch(`/api/api?id=${id}`, { method: 'DELETE' });
                loadAdminCodes();
            }
        }
        loadAdminCodes();
    </script>
</body>
</html>
